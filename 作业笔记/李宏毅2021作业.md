[toc]



# 1.所需环境

## 1.1.Kaggle

[Kaggle网站](https://www.kaggle.com/)

## 1.2.Google Colab

[許湛然视频参考资料](https://www.youtube.com/watch?v=5v41Scv_ZEM)

[許湛然视频配套代码](https://reurl.cc/ra63jE)

[Google Drive](https://drive.google.com/)

[Google Colab](https://colab.research.google.com/)

### 1.2.1.Google Colab中!和%的使用场景

类似于shell scrip的使用。

*注：*

参考资料：[菜鸟shell](https://www.runoob.com/linux/linux-shell.html)

shell script 是利用 shell 的功能所写的一个『程序 (program)』，这个程序是使用纯文字档，将一些 shell 的语法与命令(含外部命令)写在里面。

shell scrip文件存储后缀为.sh文件，Shell Script 开头的 #! 告诉系统解释此脚本文件的 Shell 程序路径，文件的语法使用 bash 的语法。

```shell
#!/bin/bash
```

#### 1.2.1.1.**!**的使用

常用语句：前面加!

```shell
ls : List all files in the current directory
ls -l : List all files in the current directory with more detail
pwd : Output the working directory
mkdir <dirname> : Create a directory named <dirname>
gdown : Download files from google drive
wget : Download files from the internet
python <python_file> : Executes a python file
```

#### 1.2.1.2.**%**的使用

常用语句：前面加%

```shell
cd <dirname> : Move to directory named <dirname>
```

### 1.2.2.使用GPU运行代码

代码执行程序->更改运行时类型->硬件加速->GPU

### 1.2.3.下载文件到Colab中

查看当前工作路径：

```shell
!pwd #output the current directory
```

新建文件夹：

```shell
!mkdir ML2021 #make a directory named ML2021
```

切换工作路径：

```shell
%cd ./ML2021 
#change directory to ML2021
```

使用下载语句进行文件下载：

```shell
# Download the file with file_id "1duQU7xqXRsOSPYeOR0zLiSA8g_LCFzoV", and rename it to Minori.jpg
!gdown --id '1duQU7xqXRsOSPYeOR0zLiSA8g_LCFzoV' --output Minori.jpg
```

### 1.2.4.使用Google Colab链接到个人Google Drive中

链接到个人Google Drive，并将Google Drive的路径加载到当下路径中。

```python
from google.colab import drive # Import a library named google.colab
drive.mount('/content/drive', force_remount=True) # mount the content to the directory `/content/drive`
```

将个人Google Drive从当前路径中卸载。

![D309CB9B-3096-4A3F-BEF0-07FBADC96B7A](https://gitee.com/zhangxin094/course-note/raw/master/HongYiLi2021/img/20220117231226.png)

### 1.2.5.使用命令面板查找相应功能

工具->命令面板

活着使用快捷键：Ctrl+Shift+P

功能：基本的功能都可以通过命令面板进行查找与执行。

例如可以通过查找*装载Google云端硬盘*从而进行个人Google Drive的链接。

# 2.使用Pytorch训练模型整体过程

神经网络工程的整体流程：

![417411A9-61B1-4347-AF7A-CE6396974701](https://gitee.com/zhangxin094/course-note/raw/master/HongYiLi2021/img/20220119233909.png)

## 2.1.起始设定：

```python
dataset = MyDataset(file)	# read data via MyDataset
tr_set = Dataloader(dataset, 16, shuffle=True)	# put dataset into Dataloader
model = MyModewl().to(device)	# contruct model and move to device
criterion = nn.MSELoss()	# set loss function
optimizer = torch.optim.SGD(model.parameters(), 0.1)	# set optimizer
```

## 2.2.开始训练：

```python
for epoch in range(n_epochs):	# iterate n_epochs
    model.train()				# set model to train mode
    for x, y in tr_set:			# iterate through the dataloader
        optimizer.zero_grad()	# set gradient to zero
        x, y = x.to(device), y.to(device)	# move data to device(cpu/cuda)
        pred = model(x)			# forward pass (compute output)
        loss = criterion(pred, y)	# compute loss
        loss.backward()			# compute gradient (backpropagation)
        optimizer.step()		# update model with optimizer
```

每次训练完一个epoch后，使用validation set（注：training set的shuffle=True，表示每一次epoch的数据顺序不一致，采用随机的方式，validation set的shuffle=False，表示Dataloader的提取数据方式为固定顺序，防止计算evaluation的结果因为数据顺序的改变而不一致）进行一次evaluation：

```python
model.eval()						# set model to evaluation mode
total_loss = 0
for x, y in dv_set:					# iterate through the dataloader
    x, y = x.to(device), y.to(device)	# move data to device (cpu/cuda)
    with torch.no_grad():			# disable gradient calculation
        pred = model(x)				# forward pass (compute output)
        loss = ctiterion(pred y)	# compute loss
    total_loss += loss.cpu().item()*len(x)	# accumulate loss
    avg_loss = total_loss / len(dv_set.dataset)	# compute averaged loss
```

在模型经过训练和验证后，挑选一个最为合适的模型，根据测试数据进行预测（该示例为预测模型，测试数据集中没有标准答案，仅需要将测试数据输入，并把预测结果保存下来即可）：

```python
model.eval()						# set mofel to evaluation model
preds = []
for x in tt_set:					# iterater through the dataloader
    x = x.to(device)				# move data to device (cpu/cuda)
    with torch.no_grad():			# disable gradient calculation
        pred = model(x)				# forward pass (compute output)
        preds.append(pred.cpu())	# collect prediction
```

## 2.3.保存模型：

```python
torch.save(model.state_dict(), path)
```

## 2.4加载模型：

```python
ckpt = torch.load(path)
model.load_state_dict(ckpt)
```

# 3.Homework 1:**COVID-19 Cases Prediction (Regression)**

## 3.1.问题描述





